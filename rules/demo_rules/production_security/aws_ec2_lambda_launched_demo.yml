AnalysisType: rule
RuleID: AWS.EC2OrLambda.Created.Demo
DisplayName: EC2 Instance Launched or Lambda Function Created (Demo)
Enabled: true
LogTypes:
  - AWS.CloudTrail
Severity: Info
CreateAlert: false
Tags:
  - demo
  - aws.ec2
  - aws.lambda
  - resource.create
  - cloud
  - compliance.soc2
  - detection.lifecycle
Description: >
  Generates a signal every time an EC2 instance is launched or a Lambda function is created in AWS. Useful for monitoring all compute and serverless creation events for inventory, auditing, or anomaly detection.
Reference: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RunInstances.html
Detection:
  - Any:
      - All:
          - Key: eventName
            Condition: Equals
            Value: RunInstances
          - Key: eventSource
            Condition: Equals
            Value: ec2.amazonaws.com
      - All:
          - Key: eventName
            Condition: Equals
            Value: CreateFunction
          - Key: eventSource
            Condition: Equals
            Value: lambda.amazonaws.com
Tests:
  - Name: EC2 Instance Launched
    ExpectedResult: true
    Log:
      eventName: RunInstances
      eventSource: ec2.amazonaws.com
      awsRegion: us-east-1
      eventTime: "2025-05-30T12:00:00Z"
      userIdentity:
        type: IAMUser
        arn: arn:aws:iam::123456789012:user/test-user
      requestParameters:
        minCount: 1
        maxCount: 1
      responseElements:
        instancesSet:
          items:
            - instanceId: i-1234567890abcdef0
      eventType: AwsApiCall
      eventVersion: "1.08"
      recipientAccountId: "123456789012"
  - Name: Lambda Function Created
    ExpectedResult: true
    Log:
      eventName: CreateFunction
      eventSource: lambda.amazonaws.com
      awsRegion: us-east-1
      eventTime: "2025-05-30T12:10:00Z"
      userIdentity:
        type: IAMUser
        arn: arn:aws:iam::123456789012:user/test-user
      requestParameters:
        functionName: my-test-function
      responseElements:
        functionArn: arn:aws:lambda:us-east-1:123456789012:function:my-test-function
      eventType: AwsApiCall
      eventVersion: "1.08"
      recipientAccountId: "123456789012"
  - Name: Not a Create Event
    ExpectedResult: false
    Log:
      eventName: StopInstances
      eventSource: ec2.amazonaws.com
      awsRegion: us-east-1
      eventTime: "2025-05-30T12:05:00Z"
      userIdentity:
        type: IAMUser
        arn: arn:aws:iam::123456789012:user/test-user
      requestParameters:
        instanceIds:
          - i-1234567890abcdef0
      eventType: AwsApiCall
      eventVersion: "1.08"
      recipientAccountId: "123456789012" 