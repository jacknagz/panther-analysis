AnalysisType: rule
Filename: panther_detection_changes_daily_demo.py
RuleID: "Panther.Detection.Changes.Daily.Demo"
DisplayName: "Daily Summary of Panther Detection Changes (Demo)"
Enabled: true
LogTypes:
  - Panther.Audit
Severity: Info
CreateAlert: false
Description: >
  Monitors and summarizes changes to Panther detections over a 24-hour period, including creation, 
  modification, and deletion of rules, data models, and global helpers. This helps track detection 
  lifecycle and maintain change history.
DedupPeriodMinutes: 1440  # 24 hours
Threshold: 1
Tags:
  - demo
  - compliance.change_management
  - usecase.siem_integrity
  - asset.detection_controls
  - risk.medium
Runbook: |
  1. Review the detection changes to ensure they were authorized
  2. Verify the changes align with change management procedures
  3. Document any unexpected changes and investigate if necessary
Reference: https://docs.panther.com/writing-detections/rules
Tests:
  - Name: Create Detection
    ExpectedResult: true
    Log:
      {
        "actionName": "CREATE_DETECTION",
        "actionParams": {
          "dynamic": {
            "input": {
              "detections": [
                {
                  "id": "AWS.IAM.RootActivity",
                  "name": "AWS Root Account Activity"
                }
              ]
            }
          }
        },
        "actionResult": "SUCCEEDED",
        "actor": {
          "attributes": {
            "email": "security@example.com",
            "emailVerified": true,
            "roleId": "12345"
          },
          "id": "user123",
          "name": "Security Team",
          "type": "USER"
        },
        "p_log_type": "Panther.Audit",
        "sourceIP": "1.2.3.4",
        "timestamp": "2024-03-20T10:00:00Z",
        "pantherVersion": "1.44.0"
      }
  - Name: Update Data Model
    ExpectedResult: true
    Log:
      {
        "actionName": "UPDATE_DATA_MODEL",
        "actionParams": {
          "input": {
            "detections": [
              {
                "id": "AWS.CloudTrail",
                "name": "AWS CloudTrail Data Model"
              }
            ]
          }
        },
        "actionResult": "SUCCEEDED",
        "actor": {
          "attributes": {
            "email": "analyst@example.com",
            "emailVerified": true,
            "roleId": "67890"
          },
          "id": "user456",
          "name": "Detection Engineer",
          "type": "USER"
        },
        "p_log_type": "Panther.Audit",
        "sourceIP": "5.6.7.8",
        "timestamp": "2024-03-20T11:00:00Z",
        "pantherVersion": "1.44.0"
      }
  - Name: Delete Global Helper
    ExpectedResult: true
    Log:
      {
        "actionName": "DELETE_GLOBAL_HELPER",
        "actionParams": {
          "dynamic": {
            "input": {
              "detections": [
                {
                  "id": "aws_helpers",
                  "name": "AWS Helper Functions"
                }
              ]
            }
          }
        },
        "actionResult": "SUCCEEDED",
        "actor": {
          "attributes": {
            "email": "admin@example.com",
            "emailVerified": true,
            "roleId": "admin123"
          },
          "id": "user789",
          "name": "System Admin",
          "type": "USER"
        },
        "p_log_type": "Panther.Audit",
        "sourceIP": "9.10.11.12",
        "timestamp": "2024-03-20T12:00:00Z",
        "pantherVersion": "1.44.0"
      }
  - Name: Failed Detection Update
    ExpectedResult: false
    Log:
      {
        "actionName": "UPDATE_DETECTION",
        "actionParams": {
          "input": {
            "detections": [
              {
                "id": "Test.Rule",
                "name": "Test Rule"
              }
            ]
          }
        },
        "actionResult": "FAILED",
        "actor": {
          "attributes": {
            "email": "user@example.com",
            "emailVerified": true,
            "roleId": "user123"
          },
          "id": "user101",
          "name": "Regular User",
          "type": "USER"
        },
        "p_log_type": "Panther.Audit",
        "sourceIP": "13.14.15.16",
        "timestamp": "2024-03-20T13:00:00Z",
        "pantherVersion": "1.44.0"
      }
  - Name: Non-Detection Action
    ExpectedResult: false
    Log:
      {
        "actionName": "GET_DETECTIONS",
        "actionParams": {},
        "actionResult": "SUCCEEDED",
        "actor": {
          "attributes": {
            "email": "viewer@example.com",
            "emailVerified": true,
            "roleId": "viewer123"
          },
          "id": "user102",
          "name": "Viewer",
          "type": "USER"
        },
        "p_log_type": "Panther.Audit",
        "sourceIP": "17.18.19.20",
        "timestamp": "2024-03-20T14:00:00Z",
        "pantherVersion": "1.44.0"
      }