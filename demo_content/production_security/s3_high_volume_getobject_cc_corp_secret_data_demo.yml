AnalysisType: rule
Filename: s3_high_volume_getobject_cc_corp_secret_data_demo.py
RuleID: "S3.HighVolumeGetObject.CC.CorpSecretData.Demo"
DisplayName: "High Volume S3 GetObject to 'cc' Objects in 'corp-secret-data'"
Enabled: true
LogTypes:
  - AWS.S3ServerAccess
Severity: High
DedupPeriodMinutes: 5
Threshold: 10
Description: |
  Detects high volumes of S3 GetObject requests to objects with 'cc' in the name from the bucket 'corp-secret-data'. This may indicate data exfiltration or unauthorized access to sensitive data.
Runbook: |
  1. Query S3 access logs for all GetObject requests by the requester ARN to the corp-secret-data bucket in the 1 hour before and after this alert
  2. Find CloudTrail activity for the requester's access key ID in the 6 hours before the access to identify how the credentials were obtained or used
  3. Check if the requester IP is associated with known VPN/proxy services or if it differs from the user's typical access patterns in the past 30 days
Reference: https://docs.aws.amazon.com/AmazonS3/latest/userguide/LogFormat.html
SummaryAttributes:
  - bucket
  - key
  - requester
  - remoteip
  - useragent
  - requestid
  - time
  - operation
Tags:
  # Required tags
  - compliance.soc2
  - usecase.insider_threat_detection
  # Optional tags
  - mitre.ta0010.exfiltration
  - mitre.t1530.data_from_cloud_storage
  - threat.insider
  - impact.confidentiality

Tests:
  - Name: High volume GetObject to cc object (should alert)
    ExpectedResult: true
    Mocks:
      - objectName: add_to_string_set
        returnValue: '["id1","id2","id3","id4","id5","id6","id7","id8","id9","id10"]'
    Log:
      bucket: corp-secret-data
      key: secret_cc_file.txt
      operation: REST.GET.OBJECT
      requester: arn:aws:iam::123456789012:user/alice
      remoteip: 1.2.3.4
      useragent: aws-cli/2.0
      requestid: id10
      time: "2024-07-01T12:00:00Z"
  - Name: Low volume GetObject to cc object (should not alert)
    ExpectedResult: false
    Mocks:
      - objectName: add_to_string_set
        returnValue: '["id1","id2","id3"]'
    Log:
      bucket: corp-secret-data
      key: secret_cc_file.txt
      operation: REST.GET.OBJECT
      requester: arn:aws:iam::123456789012:user/alice
      remoteip: 1.2.3.4
      useragent: aws-cli/2.0
      requestid: id3
      time: "2024-07-01T12:00:00Z"
  - Name: GetObject to non-cc object (should not alert)
    ExpectedResult: false
    Log:
      bucket: corp-secret-data
      key: secret_file.txt
      operation: REST.GET.OBJECT
      requester: arn:aws:iam::123456789012:user/alice
      remoteip: 1.2.3.4
      useragent: aws-cli/2.0
      requestid: id1
      time: "2024-07-01T12:00:00Z"
  - Name: GetObject to cc object in wrong bucket (should not alert)
    ExpectedResult: false
    Log:
      bucket: public-data
      key: secret_cc_file.txt
      operation: REST.GET.OBJECT
      requester: arn:aws:iam::123456789012:user/alice
      remoteip: 1.2.3.4
      useragent: aws-cli/2.0
      requestid: id1
      time: "2024-07-01T12:00:00Z" 