AnalysisType: rule
Filename: aws_s3_bucket_created_with_secret_name_demo.py
RuleID: "AWS.S3.BucketCreatedWithSecretName.Demo"
DisplayName: "AWS S3 Bucket Created with 'Secret' in Name (Demo)"
Enabled: true
LogTypes:
  - AWS.CloudTrail
Tags:
  # Required tags
  - compliance.soc2
  - usecase.configuration_management
  - usecase.data_security
  # Optional tags
  - mitre.ta0005.defense_evasion
  - mitre.t1562.impair_defenses
  - threat.misconfiguration
  - impact.confidentiality
  - resource.s3

Reports:
  Panther:
    - Configuration Management
  MITRE ATT&CK:
    - TA0005:T1562

Severity: Medium
CreateAlert: true
Description: >
  Detects when an S3 bucket is created with the word 'secret' in its name.
  Bucket names should not expose information about their contents, as they are
  globally visible in AWS. This naming pattern could indicate poor security
  hygiene or information leakage through infrastructure naming.
Reference: https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html
Runbook: >
  Verify the bucket creation was authorized and review naming standards.
  Check bucket security configuration including public access, encryption,
  and logging settings.
SummaryAttributes:
  - eventName
  - requestParameters
  - userAgent
  - sourceIpAddress
  - recipientAccountId
  - p_any_aws_arns
  - p_any_aws_account_ids

Tests:
  - Name: S3 Bucket Created With Secret In Name
    ExpectedResult: true
    Log:
      {
        "eventVersion": "1.09",
        "userIdentity": {
          "type": "AssumedRole",
          "principalId": "AIDAI23HXS4PA36HZMRGA:alice",
          "arn": "arn:aws:sts::123456789012:assumed-role/Admin/alice",
          "accountId": "123456789012",
          "accessKeyId": "ASIAI23HXS4PEXAMPLE",
          "sessionContext": {
            "attributes": {
              "creationDate": "2024-01-01T10:00:00Z",
              "mfaAuthenticated": "false"
            },
            "sessionIssuer": {
              "type": "Role",
              "principalId": "AIDAI23HXS4PA36HZMRGA",
              "arn": "arn:aws:iam::123456789012:role/Admin",
              "accountId": "123456789012",
              "userName": "Admin"
            }
          }
        },
        "eventTime": "2024-01-01T12:00:00Z",
        "eventSource": "s3.amazonaws.com",
        "eventName": "CreateBucket",
        "awsRegion": "us-east-1",
        "sourceIPAddress": "203.0.113.42",
        "userAgent": "aws-cli/2.13.0 Python/3.11.4 Darwin/23.0.0 exe/x86_64",
        "requestParameters": {
          "bucketName": "my-secret-data-bucket",
          "x-amz-acl": "private"
        },
        "responseElements": null,
        "requestID": "8E6E8F9B2C4A6D5E",
        "eventID": "a1b2c3d4-e5f6-7890-abcd-1234567890ab",
        "readOnly": false,
        "eventType": "AwsApiCall",
        "managementEvent": true,
        "recipientAccountId": "123456789012",
        "errorCode": null,
        "errorMessage": null
      }

  - Name: S3 Bucket Created With SECRET In Name Uppercase
    ExpectedResult: true
    Log:
      {
        "eventVersion": "1.09",
        "userIdentity": {
          "type": "IAMUser",
          "principalId": "AIDAI23HXS4PA36HZMRGA",
          "arn": "arn:aws:iam::123456789012:user/bob",
          "accountId": "123456789012",
          "accessKeyId": "AKIAI23HXS4PEXAMPLE",
          "userName": "bob"
        },
        "eventTime": "2024-01-01T12:00:00Z",
        "eventSource": "s3.amazonaws.com",
        "eventName": "CreateBucket",
        "awsRegion": "us-west-2",
        "sourceIPAddress": "198.51.100.10",
        "userAgent": "aws-sdk-java/1.12.261 Linux/5.4.0 Java_HotSpot/11.0.15",
        "requestParameters": {
          "bucketName": "company-SECRET-configs"
        },
        "responseElements": null,
        "requestID": "9F7F9G0C3D5B7E6F",
        "eventID": "b2c3d4e5-f6g7-8901-bcde-234567890bcd",
        "readOnly": false,
        "eventType": "AwsApiCall",
        "managementEvent": true,
        "recipientAccountId": "123456789012",
        "errorCode": null,
        "errorMessage": null
      }

  - Name: S3 Bucket Created Without Secret In Name
    ExpectedResult: false
    Log:
      {
        "eventVersion": "1.09",
        "userIdentity": {
          "type": "AssumedRole",
          "principalId": "AIDAI23HXS4PA36HZMRGA:charlie",
          "arn": "arn:aws:sts::123456789012:assumed-role/DevOps/charlie",
          "accountId": "123456789012",
          "accessKeyId": "ASIAI23HXS4PEXAMPLE",
          "sessionContext": {
            "attributes": {
              "creationDate": "2024-01-01T10:00:00Z",
              "mfaAuthenticated": "true"
            },
            "sessionIssuer": {
              "type": "Role",
              "principalId": "AIDAI23HXS4PA36HZMRGA",
              "arn": "arn:aws:iam::123456789012:role/DevOps",
              "accountId": "123456789012",
              "userName": "DevOps"
            }
          }
        },
        "eventTime": "2024-01-01T12:00:00Z",
        "eventSource": "s3.amazonaws.com",
        "eventName": "CreateBucket",
        "awsRegion": "eu-west-1",
        "sourceIPAddress": "192.0.2.50",
        "userAgent": "Terraform/1.5.0 (+https://www.terraform.io)",
        "requestParameters": {
          "bucketName": "company-application-logs"
        },
        "responseElements": null,
        "requestID": "1A2A3B4C5D6E7F8G",
        "eventID": "c3d4e5f6-g7h8-9012-cdef-34567890cdef",
        "readOnly": false,
        "eventType": "AwsApiCall",
        "managementEvent": true,
        "recipientAccountId": "123456789012",
        "errorCode": null,
        "errorMessage": null
      }

  - Name: Failed S3 Bucket Creation With Secret In Name
    ExpectedResult: false
    Log:
      {
        "eventVersion": "1.09",
        "userIdentity": {
          "type": "IAMUser",
          "principalId": "AIDAI23HXS4PA36HZMRGA",
          "arn": "arn:aws:iam::123456789012:user/eve",
          "accountId": "123456789012",
          "accessKeyId": "AKIAI23HXS4PEXAMPLE",
          "userName": "eve"
        },
        "eventTime": "2024-01-01T12:00:00Z",
        "eventSource": "s3.amazonaws.com",
        "eventName": "CreateBucket",
        "awsRegion": "ap-southeast-1",
        "sourceIPAddress": "203.0.113.99",
        "userAgent": "aws-cli/2.13.0 Python/3.11.4 Linux/5.4.0",
        "requestParameters": {
          "bucketName": "my-secret-backup-bucket"
        },
        "responseElements": null,
        "requestID": "2B3B4C5D6E7F8G9H",
        "eventID": "d4e5f6g7-h8i9-0123-defg-45678901defg",
        "readOnly": false,
        "eventType": "AwsApiCall",
        "managementEvent": true,
        "recipientAccountId": "123456789012",
        "errorCode": "BucketAlreadyExists",
        "errorMessage": "The requested bucket name is not available"
      }

  - Name: Different S3 Event Not CreateBucket
    ExpectedResult: false
    Log:
      {
        "eventVersion": "1.09",
        "userIdentity": {
          "type": "IAMUser",
          "principalId": "AIDAI23HXS4PA36HZMRGA",
          "arn": "arn:aws:iam::123456789012:user/frank",
          "accountId": "123456789012",
          "accessKeyId": "AKIAI23HXS4PEXAMPLE",
          "userName": "frank"
        },
        "eventTime": "2024-01-01T12:00:00Z",
        "eventSource": "s3.amazonaws.com",
        "eventName": "PutBucketPolicy",
        "awsRegion": "us-east-1",
        "sourceIPAddress": "198.51.100.75",
        "userAgent": "aws-cli/2.13.0 Python/3.11.4 Windows/10",
        "requestParameters": {
          "bucketName": "my-secret-data-bucket",
          "bucketPolicy": {
            "Version": "2012-10-17",
            "Statement": []
          }
        },
        "responseElements": null,
        "requestID": "3C4C5D6E7F8G9H0I",
        "eventID": "e5f6g7h8-i9j0-1234-efgh-56789012efgh",
        "readOnly": false,
        "eventType": "AwsApiCall",
        "managementEvent": true,
        "recipientAccountId": "123456789012",
        "errorCode": null,
        "errorMessage": null
      }
